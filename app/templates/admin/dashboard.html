{% extends "base.html" %}
{% block content %}
<div class="container">
    <div style="margin-bottom: 24px;">
        <h1 style="margin-bottom: 16px;">Admin Dashboard</h1>
        <div style="display:flex; gap: 20px; border-bottom: 1px solid #eee; padding-bottom: 12px;">
            <a href="/admin" class="view-link" style="font-weight:700; color:var(--text);">Courses</a>
            <a href="/admin/blog" class="view-link" style="color:var(--muted);">Blog</a>
            <a href="/admin/pages" class="view-link" style="color:var(--muted);">Pages</a>
        </div>
    </div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
        <h2 style="margin:0;">Manage Courses</h2>
        <div>
            <a href="/" class="view-link" style="margin-right:20px;">View Site</a>
            <a href="/admin/new" class="enroll-btn" style="margin:0;padding:8px 16px;">+ Add Course</a>
        </div>
    </div>

    <!-- Cleanup Section -->
    <div
        style="background:var(--card-bg); padding:24px; border-radius:12px; margin-bottom:32px; border:1px solid #333;">
        <h3 style="margin-bottom:16px; margin-top:0;">üßπ Cleanup Courses</h3>
        <p style="margin-bottom:16px; color:var(--muted); font-size:14px;">Delete old courses to keep the database
            clean. (Irreversible)</p>

        <div style="display:flex; gap:12px; flex-wrap:wrap;">
            <button onclick="deleteCourses(5)" class="danger-btn">Delete last 5 days</button>
            <button onclick="deleteCourses(10)" class="danger-btn">Delete last 10 days</button>
            <button onclick="deleteCourses(20)" class="danger-btn">Delete last 20 days</button>
        </div>
        <p id="delete-status" style="margin-top:16px; font-weight:bold; color:var(--accent-color);"></p>
    </div>

    <style>
        .danger-btn {
            background: #dc2626;
            color: white;
            padding: 10px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        .danger-btn:hover {
            background: #b91c1c;
        }
    </style>

    <script>
        async function deleteCourses(days) {
            const confirmDelete = confirm(
                `‚ö†Ô∏è WARNING: Are you sure you want to PERMANENTLY delete all courses created in the last ${days} days?`
            );

            if (!confirmDelete) return;

            const statusEl = document.getElementById("delete-status");
            statusEl.innerText = "‚è≥ Deleting...";
            statusEl.style.color = "var(--text)";

            try {
                const res = await fetch(`/admin/delete-days/${days}`, {
                    method: "DELETE"
                });

                if (!res.ok) throw new Error("Failed to delete");

                const data = await res.json();

                statusEl.innerText = `‚úÖ Success: Deleted ${data.deleted} courses from last ${days} days.`;
                statusEl.style.color = "#22c55e";

                // Optional: Reload after 2 seconds to reflect changes
                setTimeout(() => window.location.reload(), 2000);

            } catch (err) {
                console.error(err);
                statusEl.innerText = "‚ùå Error deleting courses. Check console.";
                statusEl.style.color = "#ef4444";
            }
        }
    </script>
    <!-- End Cleanup Section -->

    {% for c in courses %}
    <div class="course-card" style="align-items:center;">
        <div style="flex:1;">
            <div class="course-title">{{ c.title }}</div>
            <div class="course-desc" style="margin-bottom:4px;">{{ c.description }}</div>
            <div style="font-size:12px;color:#999;margin-bottom:8px;">Slug: {{ c.slug }}</div>
        </div>
        <div style="display:flex;gap:12px;font-size:14px;">
            <a href="/admin/edit/{{ c.id }}" class="view-link">Edit</a>
            <a href="/admin/delete/{{ c.id }}" class="view-link" style="color:#ef4444;"
                onclick="return confirm('Use with caution: Delete this course?')">Delete</a>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}